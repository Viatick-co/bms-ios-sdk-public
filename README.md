### XCode Application Frameworks
* UserNotifications.framework
* CoreLocation.framework
* NotificationCenter.framework

### Installation
* Download the `BmSDK.framework` from Github
* Link the framework `BmsSDK.framework` in your project. `Project target -> Under Embedded Binaries -> '+' Sign`
* Make sure `Info.plist` file has the following setting
```xml
<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>description for location access</string>
<key>NSLocationWhenInUseUsageDescription</key>
<string>description for location access</string>
<key>NSLocationAlwaysUsageDescription</key>
<string>description for location access</string>
<key>NSBluetoothAlwaysUsageDescription</key>
<string>We need bluetooth permission to broadcast data.</string>
<key>NSBluetoothPeripheralUsageDescription</key>
<string>We need bluetooth permission to broadcast data.</string>
```
##### Under `Capabilities` tag
* Enable `Location updates` in `Background Modes`
* Enable `Add the Push Notifcations...` in `Push Notifications`

##### Embed Mappedin.framework (for the map)
* Go to Targets > Build Phases > Embeded Frameworks
* Press "+" and select "Add Other", choose "BmsSDK.framework" inside the root folder > Frameworks > Mappedin.framework
* Make sure that "Code Sign On Copy" is ticked for Mappedin.framework

### Setup

##### Import SDK in ViewController
`Import BmsSDK`

##### Sample setup codes in ViewController

```swift
class ViewController: UIViewController {

    // Some codes...

    // declare instance of bms controller
    let viaBmsCtrl = ViaBmsCtrl.sharedInstance;

    override func viewDidLoad() {
        super.viewDidLoad()

        // Some codes...

        var requestDistanceBeacons:[IBeacon] = [];
        // let beacon:IBeacon = IBeacon(uuid: "uuid", major: 40, minor: 50);

        // configure bms sdk settings at first
        viaBmsCtrl.setting(
        alert: false, // whether to show notification when a minisite is triggered
        background: true, // whether to enable beacon scanning in background mode
        site: false, // whether to enable minisite feature
        minisitesView: .LIST, // choose either 'LIST' to display
        autoSiteDuration: 0, // if minisite view mode is 'AUTO', this specifies number of
        tracking: false, // whether to enable tracking feature and send tracking data to BMS
        enableMQTT: false, // whether to use MQTT or normal RESTful endpoint to send tracking data
        attendance: false, // whether to enable attendance feature
        checkinDuration: 5, // duration of the device staying in the authorized zones to be considered "checked in"
        checkoutDuration: 20, // duration of the device staying out of the authorized zones to be considered "checked out"
        requestDistanceBeacons: requestDistanceBeacons, // ibeacons that you want to return distance callback
        bmsEnvironment: .DEV, // BMS environment, default is "PROD"
        beaconRegionRange: 10, // range of beacon region that you want to filter, set it to 0 if you don't want it
        beaconRegionUUIDFilter: true, // when true, it will filter only the preset UUID broadcasted by the mobile device of this application
        isBroadcasting: true, // set it to true to broadcast as beacon (UUID, major, minor is generated by the system)
        proximityAlert: true, // set it to true to enable alert when proximity period with a filtered device exceed proximityAlertThreshold
        proximityAlertThreshold: 120, // minimum how long is the proximity period, in seconds,
	      proximityAwayThreshold: 120, // minimum how long is the period for a proximity device pair to be considered "away", in seconds,
	      proximityRange: 5 // range of proximity that you want to filter, set it to 0 if you don't want it
        );

    // optional to attach delegate
        // 4 callbacks
        // sdkInited
        // customerInited
        // if attendance is enable
        // checkin and checkout
        viaBmsCtrl.delegate = self;

        // this method must be called at first to do handshake with bms
        // sdkInited callback will be called
        viaBmsCtrl.initSdk(uiViewController: self, sdk_key: "PASTE_YOUR_BMS_APP_SDK_KEY_HERE");

        // Some codes...
    }

    // start sdk service
    @IBAction func startSDK(sender: UIButton) {
        // these methods are to check sdk initation and bms is running or not
        let bmsRunning = viaBmsCtrl.isBmsRunning();
        let sdkInited = viaBmsCtrl.isSdkInited();

        if (!bmsRunning && sdkInited) {
            // this method is to start bms service if it is not running
            // you can call this method to restart without calling initSdk again
            viaBmsCtrl.startBmsService();
        }
    }

    // end sdk service
    @IBAction func stopSDK(sender: UIButton) {
        // this method is to stop the bms service
        viaBmsCtrl.stopBmsService();
    }

    // open a minisite url (from NFC Tag or others) as a minisite on the same app
    @IBAction func openDeviceSite(sender: UIButton) {
        // this method is to stop the bms service
        let url = "https://DEVICE_SITE_URL";

        viaBmsCtrl.openDeviceSite(url);
    }

    // open a minisite url (from NFC Tag or others) as a minisite on the same app
    @IBAction func destroySDK(sender: UIButton) {
        // destroy the SDK instance so it can be initiated again

        viaBmsCtrl.destroySDK();
    }

    // Some codes...
}

// implement delegate of bms here
extension ViewController: ViaBmsCtrlDelegate {

    // this will be called when sdk is inited
    // list of zones in the sdk application is passed here
    func sdkInited(inited status: Bool, zones: [ViaZone]) {
        print("sdk inited", status);

        // this method must be called in order to enable attendance and tracking feature
        // authorizedZones is optional field
    // sdkInited callback will be called after initialization
        viaBmsCtrl.initCustomer(identifier: "PASTE IDENTIFIER OF CUSTOMER HERE", email: "example@email.com", phone: "+000000000", remark: "Device info!", authorizedZones: zones);
    }

    func customerInited(inited: Bool) {
        print("customer inited", inited);
    }

    func checkin() {
        print("check in callback");
    }

    func checkout() {
        print("check out callback");
    }

    // it is callback of request tracking beacons
    func onDistanceBeacons(beacons: [IBeacon]) {
    }

    // callback when a device site is loaded, error code will be returned if failed
    func deviceSiteLoaded(loaded: Bool, error: String?) {

    }

    // call on applicationWillTerminate
    func onDestroy() {
        print("onDestroy");
    }

    // callback when there's new proximity alert (contact) been established
    func onNewProximityAlert(uuid: String, major: Int, minor: Int, deviceUUID: String) {

    }

    // callback when Bluetooth state is switched to on
    func onBluetoothStateOn() {
    }

    // callback when Bluetooth state is switched to off
    func onBluetoothStateOff() {
    }

    // callback when there's a new zone record added
    // returns the uuid, major, minor of the beacon as well as the zones that the beacon is associated to
    func onAddZoneRecord(uuid: String?, major: Int, minor: Int, newZones: [ViaZone]?) {
    }

    // callback when the map is initiated
    func onMapInited(status: Bool) {
    }

    // callback when a zone on the map is tapped/clicked
    func onZoneClicked(zoneName: String) {
    }

    // returns the zones requested by getZones
    // zone Dictionary consists of name and zoneId parameters
    func onZonesLoaded(zones: [Dictionary<String, Any>]) {
    }

    // return the zone records request getLastProperZoneRecords
    // zone record Dictionary consists of zoneRecordId, start, end, customer, zone parameters
    // customer parameter is a Dictionary consists of customerId, identifier, email, phone
    // zone parameter is a Dictionary consists of zoneId, name
    func onProperZoneRecordsLoaded(zoneRecords: [Dictionary<String, Any>]) {
    }
}
```

##### Sample setup map in ViewController

```swift
class ViewController: UIViewController {

    // Some codes...

    // declare instance of bms controller
    let viaBmsCtrl = ViaBmsCtrl.sharedInstance;

    override func viewDidLoad() {
        super.viewDidLoad()

        // Some codes...

        // Attach delegate to listen to callbacks
        viaBmsCtrl.delegate = self;

        // indicate width and height of the map view. Here we use the width and height of the UI screen bound as example
        let screenRect = UIScreen.main.bounds
        let screenWidth = screenRect.size.width
        let screenHeight = screenRect.size.height

        viaBmsCtrl.initMap(view: self.view!, width: screenWidth, height: screenHeight, sdk_key: "PASTE_YOUR_BMS_APP_SDK_KEY_HERE");

        // Some codes...
    }

    // add a single marker
    // should only be called after the map is initiated (status returned on onMapInited callback)
    @IBAction func addMarker(sender: UIButton) {
        // you can fully custom the html content of your marker
        viaBmsCtrl.addMarker(zoneName: "Zone A", content: "<p style=\"color: #eb4d4b;\">1</p>")
    }

    // you can also use addMarker to have a "blue dot" like marker to visualize a user's current zone
    // possibly onAddZoneRecord callback can be used to retrieve the zone to be visualized
    // We provided you a sample HTML content for a blue dot at ViaBmsCtrl.BLUEDOT_CONTENT
    // Refer to blueDotSimulation function on bms-sdk-ios-map-example for sample
    @IBAction func addBlueDot(sender: UIButton) {
        // you can fully custom the html content of your marker
        viaBmsCtrl.addMarker(zoneName: "Zone A", content: ViaBmsCtrl.BLUEDOT_CONTENT)
    }

    // add a group of markers
    // MarkerInput class has 2 parameters: zoneName and content. Both are String.
    // should only be called after the map is initiated (status returned on onMapInited callback)
    @IBAction func addMarkers(sender: UIButton) {
        // you can fully custom the html content of your marker
        var markers: [MarkerInput] = []
        markers.append(MarkerInput(zoneName: "Zone A", content: "<p style=\"color: #eb4d4b;\">1</p>"))
        markers.append(MarkerInput(zoneName: "Zone B", content: "<p style=\"color: #eb4d4b;\">2</p>"))
        viaBmsCtrl.addMarkers(markers: markers)
    }

    // remove a group of markers
    // input is an array of zone names
    @IBAction func removeMarkers(sender: UIButton) {
        viaBmsCtrl.removeMarkers(markers: ["Zone A", "Zone B"])
    }

    // get the list of zones of this application
    // result won't be returned here but on the onZonesLoaded callback below
    // should only be called after the map is initiated (status returned on onMapInited callback)
    @IBAction func getZones(sender: UIButton) {
        viaBmsCtrl.getZones()
    }

    // get the list of zones of this application
    // result won't be returned here but on the onZonesLoaded callback below
    // should only be called after the map is initiated (status returned on onMapInited callback)
    @IBAction func getLastProperZoneRecords(sender: UIButton) {
        viaBmsCtrl.getLastProperZoneRecords()
    }

    // Some codes...
}

// implement delegate of bms here
extension ViewController: ViaBmsCtrlDelegate {

    // this will be called when sdk is inited
    // list of zones in the sdk application is passed here
    func sdkInited(inited status: Bool, zones: [ViaZone]) {
        print("sdk inited", status);

        // this method must be called in order to enable attendance and tracking feature
        // authorizedZones is optional field
    // sdkInited callback will be called after initialization
        viaBmsCtrl.initCustomer(identifier: "PASTE IDENTIFIER OF CUSTOMER HERE", email: "example@email.com", phone: "+000000000", remark: "Device info!", authorizedZones: zones);
    }

    func customerInited(inited: Bool) {
        print("customer inited", inited);
    }

    func checkin() {
        print("check in callback");
    }

    func checkout() {
        print("check out callback");
    }

    // it is callback of request tracking beacons
    func onDistanceBeacons(beacons: [IBeacon]) {
    }

    // callback when a device site is loaded, error code will be returned if failed
    func deviceSiteLoaded(loaded: Bool, error: String?) {

    }

    // call on applicationWillTerminate
    func onDestroy() {
        print("onDestroy");
    }

    // callback when there's new proximity alert (contact) been established
    func onNewProximityAlert(uuid: String, major: Int, minor: Int, deviceUUID: String) {

    }

    // callback when Bluetooth state is switched to on
    func onBluetoothStateOn() {
    }

    // callback when Bluetooth state is switched to off
    func onBluetoothStateOff() {
    }

    // callback when there's a new zone record added
    // returns the uuid, major, minor of the beacon as well as the zones that the beacon is associated to
    func onAddZoneRecord(uuid: String?, major: Int, minor: Int, newZones: [ViaZone]?) {
    }

    // callback when the map is initiated
    func onMapInited(status: Bool) {
        print("onMapInited", status)
        if (status) {
            // do something when the map is initiated
        }
    }

    // callback when a zone on the map is tapped/clicked
    func onZoneClicked(zoneName: String) {
        // do something when a zone is clicked
        print(zoneName, " is clicked")
    }

    // returns the zones requested by getZones
    // zone Dictionary consists of name and zoneId parameters
    func onZonesLoaded(zones: [Dictionary<String, Any>]) {
        print("onZonesLoaded", zones)
    }

    // return the zone records request getLastProperZoneRecords
    // zone record Dictionary consists of zoneRecordId, start, end, customer, zone parameters
    // customer parameter is a Dictionary consists of customerId, identifier, email, phone
    // zone parameter is a Dictionary consists of zoneId, name
    func onProperZoneRecordsLoaded(zoneRecords: [Dictionary<String, Any>]) {
        print("onProperZoneRecordsLoaded", zoneRecords)
    }
}
```
